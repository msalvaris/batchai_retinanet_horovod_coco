{
  "$schema": "https://raw.githubusercontent.com/Azure/BatchAI/master/schemas/2017-09-01-preview/job.json",
  "properties": {
    "nodeCount": 2,
    "customToolkitSettings": {
      "commandLine": "echo $AZ_BATCH_HOST_LIST; cat $AZ_BATCHAI_MPI_HOST_FILE; mpirun -np 8 -bind-to none -map-by slot -x NCCL_DEBUG=INFO -x LD_LIBRARY_PATH -mca btl_tcp_if_include eth0 -x NCCL_SOCKET_IFNAME=eth0 -mca btl ^openib -x NCCL_IB_DISABLE=1 --allow-run-as-root  --hostfile $AZ_BATCHAI_MPI_HOST_FILE python -u $AZ_BATCHAI_MOUNT_ROOT/extfs/scripts/train.py --steps 500 --tensorboard-dir $AZ_BATCHAI_OUTPUT_OUTPUTFILES/tensorboard --snapshot-path $AZ_BATCHAI_OUTPUT_OUTPUTFILES --no-evaluation coco $AZ_BATCHAI_MOUNT_ROOT/extcn"
    },
    "stdOutErrPathPrefix": "$AZ_BATCHAI_MOUNT_ROOT/extfs",
    "containerSettings": {
                "imageSourceRegistry": {
                    "image": "masalvar/horovod-batchai-coco-retinanet-open:9-1.8-0.13.6"
                }
    },
    "outputDirectories": [
      {
        "id": "OUTPUTFILES",
        "pathPrefix": "$AZ_BATCHAI_MOUNT_ROOT/extfs",
        "pathSuffix": "output"
      }
    ]
  }
}
