{
  "$schema": "https://raw.githubusercontent.com/Azure/BatchAI/master/schemas/2017-09-01-preview/job.json",
  "properties": {
    "nodeCount": 2,
    "customToolkitSettings": {
      "commandLine": "source /opt/intel/compilers_and_libraries_2017.4.196/linux/mpi/intel64/bin/mpivars.sh; echo $AZ_BATCH_HOST_LIST; ifconfig -a; mpirun -n 8 -ppn 4 -hosts $AZ_BATCH_HOST_LIST  -envlist LD_LIBRARY_PATH,PATH -env I_MPI_FABRICS=dapl -env I_MPI_DAPL_PROVIDER=ofa-v2-ib0 -env I_MPI_DYNAMIC_CONNECTION=0 -env I_MPI_DEBUG=6 -env I_MPI_HYDRA_DEBUG=on -env NCCL_DEBUG=INFO python -u $AZ_BATCHAI_MOUNT_ROOT/extfs/scripts/train.py --steps 500 --tensorboard-dir $AZ_BATCHAI_OUTPUT_OUTPUTFILES/tensorboard --snapshot-path $AZ_BATCHAI_OUTPUT_OUTPUTFILES --no-evaluation coco $AZ_BATCHAI_MOUNT_ROOT/extcn"
    },
    "stdOutErrPathPrefix": "$AZ_BATCHAI_MOUNT_ROOT/extfs",
    "containerSettings": {
                "imageSourceRegistry": {
                    "image": "masalvar/horovod-batchai-coco-retinanet:9-1.8-0.13.6"
                }
    },
    "outputDirectories": [
      {
        "id": "OUTPUTFILES",
        "pathPrefix": "$AZ_BATCHAI_MOUNT_ROOT/extfs",
        "pathSuffix": "output"
      }
    ]
  }
}
